<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.5 'PT Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'PT Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}ul{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:0.85rem;line-height:1.5rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1rem;line-height:1.5rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0.9375rem;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1.1487rem;line-height:1.5rem;border-left:0.5625rem solid #292d35;color:hsla(0,0%,0%,0.65);font-style:italic;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.5rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.5rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}li > ul{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.5rem / 2);}code{font-size:0.85rem;line-height:1.5rem;}kbd{font-size:0.85rem;line-height:1.5rem;}samp{font-size:0.85rem;line-height:1.5rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:calc(0.75rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#292d35;text-decoration:none;text-shadow:.03em 0 #fff,-.03em 0 #fff,0 .03em #fff,0 -.03em #fff,.06em 0 #fff,-.06em 0 #fff,.09em 0 #fff,-.09em 0 #fff,.12em 0 #fff,-.12em 0 #fff,.15em 0 #fff,-.15em 0 #fff;background-image:linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 1px, #292d35 1px, #292d35 2px, rgba(0, 0, 0, 0) 2px);}a:hover,a:active{text-shadow:none;background-image:none;}h1,h2,h3,h4,h5,h6{margin-top:3rem;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.5rem;color:hsla(0,0%,0%,0.8);font-style:normal;font-weight:400;}blockquote cite:before{content:"— ";}@media only screen and (max-width:480px){html{font-size:106.25%;line-height:24.65px;}blockquote{border-left:0.28125rem solid #292d35;color:hsla(0,0%,0%,0.59);padding-left:0.84375rem;font-style:italic;margin-left:-1.125rem;margin-right:0;}}</style><style data-href="/styles.9049d68c607a167417b5.css">header h3,header h5{display:inline-block;padding-right:.5rem;margin-top:0}header a{text-shadow:none;background-image:none;text-decoration:none;vertical-align:middle}header a:hover{color:red}header a img{vertical-align:middle}.blog-list a:hover{color:#000}.blog-list h2,.blog-list h4{margin-bottom:.5rem}.blog-list h4{font-style:italic;margin-top:0}.blog-list h4 span{display:inline-block;color:grey;font-size:.8rem}.postIntro h1{font-size:2.5rem;width:100%;text-align:center;margin-top:1rem;margin-bottom:.5rem}.postIntro p.tags{font-size:.8rem;color:grey;margin:0;text-align:center}.postIntro p.date{margin:0 0 1rem;text-align:center}.postIntro p.intro{margin-top:1.5rem;font-style:italic}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.3.4"/><link href="//fonts.googleapis.com/css?family=Oswald:700|PT+Sans:400,400i,700" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css"/><title data-react-helmet="true">Avec ou sans Redux ?</title><meta data-react-helmet="true" name="author" content="Àlexis Janvier"/><meta data-react-helmet="true" name="description" content="Redux est un outil fantastique, mais convient-t-il à toutes les situations ? Sans doute pas."/><meta data-react-helmet="true" name="keywords" content="react,redux,render prop,react context"/><meta data-react-helmet="true" itemProp="name" content="Avec ou sans Redux ?"/><meta data-react-helmet="true" itemProp="description" content="Redux est un outil fantastique, mais convient-t-il à toutes les situations ? Sans doute pas."/><meta data-react-helmet="true" itemProp="image" content="https://www.alexisjanvier.net/covers/reduxOrNot.jpg"/><meta data-react-helmet="true" property="og:title" content="Avec ou sans Redux ?"/><meta data-react-helmet="true" property="og:description" content="Redux est un outil fantastique, mais convient-t-il à toutes les situations ? Sans doute pas."/><meta data-react-helmet="true" property="og:image" content="https://www.alexisjanvier.net/covers/reduxOrNot.jpg"/><meta data-react-helmet="true" property="og:url" content="https://www.alexisjanvier.net/avec-ou-sans-redux"/><meta data-react-helmet="true" property="og:site_name" content="alexisjanvier.net"/><meta data-react-helmet="true" name="twitter:title" content="Avec ou sans Redux ?"/><meta data-react-helmet="true" name="twitter:description" content="Redux est un outil fantastique, mais convient-t-il à toutes les situations ? Sans doute pas."/><meta data-react-helmet="true" name="twitter:image" content="https://www.alexisjanvier.net/covers/reduxOrNot.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image:alt" content="Avec ou sans Redux ?"/><meta data-react-helmet="true" name="twitter:creator" content="@alexisjanvier"/><meta data-react-helmet="true" name="twitter:site" content="@alexisjanvier"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/webpack-runtime-e6f938376c01eb7ce981.js"/><link as="script" rel="preload" href="/app-6c5376e06f2d7e34c5c3.js"/><link as="script" rel="preload" href="/styles-7d82cead6d54fb5cd7e1.js"/><link as="script" rel="preload" href="/1-2dea483b5ed5e468183a.js"/><link as="script" rel="preload" href="/2-0e0f7c0717f48b96baf5.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-a3c7316724bb72f3a7bc.js"/><link as="fetch" rel="preload" href="/static/d/500/path---avec-ou-sans-redux-0-f-5-044-B1Q7yjhwRp4bpnEaLa9yERDGMoc.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header><div style="margin:0 auto;max-width:1000px;padding:1.25rem 1rem"><header style="margin-bottom:1.5rem"><a href="/"><h3>This is not &#x27;Nam.</h3><h5>This is web development. There are rules.</h5></a><ul style="list-style:none;float:right"><li style="display:inline-block;margin-right:1rem"><a href="/">Blog</a></li><li style="display:inline-block;margin-right:1rem"><a href="/about/">About</a></li><li style="display:inline-block;margin-right:1rem"><a href="https://twitter.com/alexisjanvier"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAjcAAAI3AfcGRMIAAAAHdElNRQfhCQEKGCQX757NAAACjElEQVRIx62VX0hTURzHP/e6NRkYLREcrLeCfFDBGL4UiWGJL+sP9FLkQ4FR7MGHhHTe251OqRBJX6qXIBDCelCQIAYS9CSVBCsHFT3EaIIxs8HYmnp72N28/zYn+Hs653fO93Pv7/x+5/wEFatNu9Y71QBNePECSZLEhXnPYjBn3SuYAWPevMQV6my4aWac4cFkBYBSS4h+3JS3DJOMyllbgNLIHO3sbkucl1ctgJHm7df4qpADJMSe4ZgBoDTyvmo5QAJ/4S9ELfa5PcnBx5xSWwIQqhj7Jo+Fy5wRBvgBQIy/QDshLYQxb/67dvKPOEWbSZ7inPyhMHxQl72lRnHzrpAR59HBpAh5qZS4Wbr4aALcLsphIC3d5w+XeAOAOy+BMOVKrZXK5oicmHalJAZwaJ4N2YOp1sIB9ZW2nj7cIK536qruJARz8pDYxlM2APhslo+cUGdL+Lr1TlEN6FZ7X9YADMfkPhqFs/SzYD7RbT8HdmZqwEGTbjUWv8GTwlDOEiVqk5MWw6zJgVc3fSEt71oBrYaZVzQAru8qF2g2A/TWp1ysrB89br7oIvr7XcNzZWK8oTxgK2JyJI0AyPDw7lo5udLNBSsgbnA08AzBXj7tYsrijIvCvMnVrSyH7yg2dzM1yDHLmc6LnkXSJm+r2oJo3qqEkCzMtGfREcwpM9wE4Be/WeELC/In477x+n8T9NpENRPMOcAZzl/DDRxklkn5p+nLh7jKPept5BlnWHvSlFGGNOcmUVaEb3xVt/Dh4zRdOMskJSKHioBa3lb1HuttiQ45u1+PKsirYg+J6uViT7EzlNI1HMPPUpU/7y92BfT5llfpIEKmojhDhI6dvrTfzbVoe2nv/wH5+trdc83aGwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wOS0wMVQxMDoyNDozNiswMjowMORVb1wAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDktMDFUMTA6MjQ6MzYrMDI6MDCVCNfgAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAA10RVh0VGl0bGUAVHdpdHRlcpMAsEgAAABXelRYdFJhdyBwcm9maWxlIHR5cGUgaXB0YwAAeJzj8gwIcVYoKMpPy8xJ5VIAAyMLLmMLEyMTS5MUAxMgRIA0w2QDI7NUIMvY1MjEzMQcxAfLgEigSi4A6hcRdPJCNZUAAAAASUVORK5CYII="/></a></li><li style="display:inline-block;margin-right:1rem"><a href="https://github.com//alexisjanvier"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAjcAAAI3AfcGRMIAAAAHdElNRQfhCQEKFycJftO4AAAC2ElEQVRIx62VTUhUURTHf/c10/hJ+VH6wtqVWhi0qHEhItIiKhzbtCncRFSLWQhRJubrjTqLXAjZoqKPlVA7B0JXCUIIOqiLIkcNizRGEfxoBptpdF6LefPmOTM5Cp3NOx/3/7/3nHfPPUIjVXptq/Wag0pkZMCPnynhKRhyhlPXimQCtxxp5xr5aXgD9Fldrf4dCNQs2mgmh3/LBj10KqG0BGop/djZWZYpZoxGZTHukOJKRxVe7CyTi4O3bKTZ+zV25TAj2PF2VCWdQC3FSxkwrVQAPM7/7RRLzO2bs6yFiigWR7Vx5TuA+pIbwAJnY6ew6Ln3U2be7l4At2GsM8eYseO0BlBGv1qnhOIptGXMPSFR/WunTa+BW6bZCE9mwmuvmNfVZrcMEkTajR8XsrRkIlDWxANdzYm0g3hiW1k2rs0L5VbmHHptK8FY7QgUHpJW6023bj4zHJxhvuhq/mq9pDlMsbVdFtK4JZpDojLhF7m7JMgztEoJ2VThwj0TyBZkQCPICjMs7ZLgJ0EKKMGCHO+FLbKpoEE9kRmtXmCdTfbHLqF4NMNxU/QH9kSnpYWfY4Aiw5yV2P5AHGPCdWnH3T+Y4OC3MEWtbgQZ5DKy9l79iEcajM4qfwxglnQm6uAKySlOScKTqK0YphofUEN39DPXE+vEjegI91PgCI9UMEQgbmrd0pbUxCwAXuVNYqH2HF+ajAIFQ5IzTJ/hyI6+s36lDid3qEVTs0C9C2qOssl4GoI+Z9gCVlekyejHU+FnttstT3XrJBPkAdUM8SsFvmF1gQStfnpM7qvhb6pP9bluAqd1Xw0kEjWkp9Uff5E6GTUFDlBOuVYEokT3HOm1kTxARukEnUAJ0chCaoqaiGsrgqxtoQUaY9PBmAsdVdGBbQ/rOsMcZJDzTNJAIcVmuHTx4Sf9R+5xsMQOn26wgLJIHV1pRsq2ytNFnblb/u9wjctexvtf2qD0QeZRdFEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMDktMDFUMTA6MjM6MzkrMDI6MDDwwQTMAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTA5LTAxVDEwOjIzOjM5KzAyOjAwgZy8cAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAMdEVYdFRpdGxlAEdpdEh1YlTKy1sAAABXelRYdFJhdyBwcm9maWxlIHR5cGUgaXB0YwAAeJzj8gwIcVYoKMpPy8xJ5VIAAyMLLmMLEyMTS5MUAxMgRIA0w2QDI7NUIMvY1MjEzMQcxAfLgEigSi4A6hcRdPJCNZUAAAAASUVORK5CYII="/></a></li></ul></header><div><div class="postIntro"><h1>Avec ou sans Redux ?</h1><p class="date">Publié le <!-- -->04 juin 2018</p></div><div><p>Chez Marmelab on aime beaucoup <a href="https://redux.js.org/">Redux</a>. Il faut dire que son arrivée a été un vrai moment d'évolution dans notre manière de penser nos applications : store immutable, sensibilisation à la programmation fonctionnelle, gestion asynchrone des call API avec les générateurs de Redux-Saga, ... À tel point que l'on a eu tendance à l'intégrer de facto dans notre stack en démarrage de projet.<br>
Mais est-ce vraiment une bonne idée ? Pas certain ...</p>
<h2>Un Exemple</h2>
<p>Prenons une application très simple de gestion de meetup. L'objectif est de pouvoir visualiser :</p>
<ul>
<li>une liste des propositions de talks,</li>
<li>une liste de souhaits de talks,</li>
<li>une liste des membres du meetup.</li>
</ul>
<p>Les données sont obtenues via une <a href="https://expressserver-xsdtbkkhsf.now.sh">API REST</a> et l'application tout comme l'API sont protégées par un login/password.</p>
<p>L'application est bootstrappée avec <a href="https://github.com/facebook/create-react-app">Create React App</a> auquel on rajoute :</p>
<ul>
<li><a href="https://redux.js.org/">Redux</a></li>
<li><a href="https://redux-saga.js.org/">Redux-Saga</a></li>
<li><a href="https://github.com/reactjs/react-router-redux">react-router-redux</a></li>
</ul>
<p>Voilà à quoi ressemble le projet :</p>
<iframe src="https://codesandbox.io/embed/m5n2xjl6pj?autoresize=1&module=%2Fsrc%2FApp.js&moduleview=1&view=editor" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
<p>Cette application commence donc par un composant principal <code class="language-text">App.js</code> qui se charge de monter le store Redux <code class="language-text">&lt;Provider store={store}&gt;</code> et les routes <code class="language-text">&lt;ConnectedRouter history={history}&gt;</code> :</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in App.js</span>
<span class="token operator">...</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> store<span class="token punctuation">,</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>
       <span class="token operator">&lt;</span>ConnectedRouter history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">></span>
           <span class="token operator">&lt;</span>Container<span class="token operator">></span>
               <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
               <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">"/"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/talks"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Talks<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/wishes"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Wishes<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/members"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Members<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/login"</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Authentication<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                   <span class="token operator">&lt;</span>Route component<span class="token operator">=</span><span class="token punctuation">{</span>NoMatch<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
               <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
           <span class="token operator">&lt;</span><span class="token operator">/</span>Container<span class="token operator">></span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>ConnectedRouter<span class="token operator">></span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tous les composants <em>métier</em> (ceux rendus par une route, comme <code class="language-text">&lt;Route path=&quot;/talks&quot; component={Talks} /&gt;</code> sont organisés selon la structure bien connue des utilisateurs de Redux :</p>
<ul>
<li>les actions,</li>
<li>les reducers,</li>
<li>les sagas.</li>
</ul>
<p>Par exemple pour la page des talks :</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">├── talks
│   ├── actions.js
│   ├── reducer.js
│   ├── sagas.js
│   └── Talks.js</code></pre></div>
<p>Le composant de page est très simple :</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in talks/Talks.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Talks</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> talks <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>div<span class="token operator">></span>
       <span class="token operator">&lt;</span>h1<span class="token operator">></span>Talks<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
       <span class="token punctuation">{</span>isLoading <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
       <span class="token punctuation">{</span>talks <span class="token operator">&amp;&amp;</span> talks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">talk</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>h2 key<span class="token operator">=</span><span class="token punctuation">{</span>talk<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>talk<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>  talks <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
   isLoading<span class="token punctuation">:</span> talks<span class="token punctuation">.</span>isLoading<span class="token punctuation">)</span><span class="token punctuation">,</span>
   talks<span class="token punctuation">:</span> talks<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Talks<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Les données <code class="language-text">talks</code> ne sont pas appelées au <code class="language-text">ComponentWillMount</code> comme on pourrait s'y attendre mais grâce à une saga à l'écoute du routeur :</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in talks/sagas.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> put<span class="token punctuation">,</span> select<span class="token punctuation">,</span> takeLatest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">LOCATION_CHANGE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> loadTalks <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./actions'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hasData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">handleTalksLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span>hasData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token function">loadTalks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sagas</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">takeLatest</span><span class="token punctuation">(</span>
        <span class="token parameter">action</span> <span class="token operator">=></span>
            action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">LOCATION_CHANGE</span> <span class="token operator">&amp;&amp;</span>
            action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>pathname <span class="token operator">===</span> <span class="token string">'/talks'</span><span class="token punctuation">,</span>
        handleTalksLoading<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Au changement de route <code class="language-text">action.type === LOCATION_CHANGE</code> - si la nouvelle route correspond à la section des talks <code class="language-text">action.payload.pathname === &#39;/talks&#39;</code> et que les données ne sont pas déja présentes <code class="language-text">if (yield select(hasData))</code> - on lance une action avec la fonction <code class="language-text">loadTalks</code> :</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in talks/actions.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-actions'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">LOAD_TALKS</span> <span class="token operator">=</span> <span class="token string">'LOAD_TALKS'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loadTalks <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
    <span class="token constant">LOAD_TALKS</span><span class="token punctuation">,</span>
    <span class="token parameter">payload</span> <span class="token operator">=></span> payload<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        request<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            url<span class="token punctuation">:</span> <span class="token string">'/talks'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Cette action contenant l'url permettant d'obtenir les données sur les talks dans ses <strong>meta</strong> va être interceptée par une <strong>saga</strong> générique de fetch <code class="language-text">action =&gt; !!action.meta &amp;&amp; action.meta.request</code>:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in /services/fetch/fetchSagas.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> takeEvery<span class="token punctuation">,</span> select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-actions'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> appFetch <span class="token keyword">as</span> fetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">createAction</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_ERROR`</span></span><span class="token punctuation">,</span>
        <span class="token parameter">payload</span> <span class="token operator">=></span> payload<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            disconnect<span class="token punctuation">:</span> error<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_SUCCESS`</span></span><span class="token punctuation">)</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">executeFetchSaga</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> type<span class="token punctuation">,</span> meta<span class="token punctuation">:</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> error<span class="token punctuation">,</span> response <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>fetch<span class="token punctuation">,</span> request<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token function">fetchError</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token function">fetchSuccess</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sagas</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>
        <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>action<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> action<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>request<span class="token punctuation">,</span>
        executeFetchSaga<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Une fois le fetch réussi <code class="language-text">fetchSuccess</code>, on lance une dernière action indiquant la réussite de la récupération des données <code class="language-text">createAction(&#39;${type}_SUCCESS&#39;)(response)</code>, action utilisée au niveau du <strong>reducer</strong> des talks :</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// in talks/reducers.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">handleActions</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token constant">LOAD_TALKS</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token operator">...</span>state<span class="token punctuation">,</span>
            loading<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token constant">LOAD_TALKS_SUCCESS</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token operator">...</span>state<span class="token punctuation">,</span>
            loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            data<span class="token punctuation">:</span> payload<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    defaultState<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Et tout cela marche très bien. C'est plutôt malin, et pourquoi pas un peu élégant. L'utilisation des <strong>meta</strong> des actions permet de partager des comportements génériques au sein de l'application (le fetch, mais aussi la gestion des erreurs, la deconnexion).</p>
<blockquote>
<p>Vous pouvez trouver le code <em>complet</em> sur <a href="https://github.com/alexisjanvier/javascript-playground/releases/tag/cra-with-redux">GitHub</a></p>
</blockquote>
<h2>C'est Malin, Mais c'est Surtout Très Complexe !</h2>
<p>Pas facile de s'y retrouver en arrivant sur l'application tant un certain nombre de comportements relèvent de la <em>magie</em>. Car si on récapitule, on obtient les données des talks via une saga branchée sur le routeur qui envoi une action de type fetch interceptée par une autre saga générique qui en cas de succès émet une autre action, action interceptée par le reduceur de la page ayant émis la toute première action de la chaine ...<br>
Certains dirons peut-être qu'il s'agit ici d'une utilisation <em>hors des cloues de Redux</em>, mais c'est surtout le résultat de plusieurs projets réalisés sur cette stack, avec l'expérience d'écritures répetitives d'actions et de reducers.</p>
<p>Se rajoute à  cette complexité une <em>plomberie</em> non négligeable, c'est à dire beaucoup de fichiers répétés pour chaque feature (les actions, les reducers et autres sagas).</p>
<p>Analysons l'application d'exemple avec ses trois pages, sa home et sa page de login :</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ cloc services/cra_webapp/src
     32 text files.
     32 unique files.
      0 files ignored.

github.com/AlDanial/cloc v 1.74  T<span class="token operator">=</span>0.06 s <span class="token punctuation">(</span>581.6 files/s, 17722.1 lines/s<span class="token punctuation">)</span>
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JavaScript                      31            150              1            819
CSS                              1              0              0              5
-------------------------------------------------------------------------------
SUM:                            32            150              1            824
-------------------------------------------------------------------------------</code></pre></div>
<p><strong>31 fichiers, 819 lignes de code</strong>, c'est déja beaucoup pour une application très simple. Le code pourrait sûrement être simplifié un peu mais au risque de le rendre moins générique.</p>
<p><strong>C'est certainement le moment de se poser la question de savoir si Redux est ici bien nécessaire ?</strong></p>
<blockquote>
<p>Redux is a predictable state container for JavaScript apps.</p>
</blockquote>
<p>Différentes parties de l'application doivent-elles modifier les mêmes données, nécessitant de maintenir un état prédictible de nos données ? Non, on doit juste afficher des données provenant de l'API.<br>
A-t-on des composants enfouis dans le DOM dont l'interaction induit une modification des données ? Non plus.</p>
<p>On doit donc sûrement pouvoir se passer de Redux.</p>
<h2>Obtenir les Données Sans Redux</h2>
<p>Ou plutôt sans utiliser <strong>Redux-Saga</strong>, chargé de rendre disponibles les données nécessaires à l'affichage de nos pages au niveau du <strong>store</strong> de Redux depuis l'API. On pourrait implémenter toute la logique de fetch au niveau de chaque page. Mais ce serait dupliquer une mécanique très répétitive. Il faut donc trouver une manière générique de réaliser ce fetch sans introduire trop de complexité.<br>
Et la pattern de <a href="https://cdb.reacttraining.com/use-a-render-prop-50de598f11ce"><strong>render prop</strong></a> est particulièrement adaptée à cela !</p>
<p>Nous allons créer un composant <code class="language-text">DataProvider</code> :</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in DataProvider.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Fragment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> appFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./services/fetch'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DataProvider</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        render<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
        url<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
        error<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">appFetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                data<span class="token punctuation">:</span> data<span class="token punctuation">.</span>response<span class="token punctuation">,</span>
                error<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                error<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> location <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> error<span class="token punctuation">.</span>code <span class="token operator">>=</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>code <span class="token operator">&lt;=</span> <span class="token number">403</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">"/login"</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>p<span class="token operator">></span>Erreur lors du chargement des données<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Fragment<span class="token operator">></span>
                <span class="token punctuation">{</span>data <span class="token operator">?</span> <span class="token punctuation">(</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">></span>Aucune donnée disponible<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
                <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        data<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ce composant réalise un fetch sur l'url qui lui est passé en prop au <code class="language-text">componentDidMount</code>. Il va se charger de la gestion des erreurs et de l'absence de donnée. Et si il obtient des données, il <em>passe le main</em> à la fonction qui lui est donnée en prop <code class="language-text">render</code> pour réaliser l'affichage <code class="language-text">this.props.render({ data })</code>.</p>
<p>Implémentons ce composant sur notre page de talks :</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in talks/Talks.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> DataProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../DataProvider'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">TalksView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> talks <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>Talks<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token punctuation">{</span>talks <span class="token operator">&amp;&amp;</span> talks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">talk</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>h2 key<span class="token operator">=</span><span class="token punctuation">{</span>talk<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>talk<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

TalksView<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    talks<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>array<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Talks</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>DataProvider
        url<span class="token operator">=</span><span class="token string">"/talks"</span>
        render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>TalksView talks<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>On a deux composants :</p>
<ul>
<li>le composant <code class="language-text">TalksView</code> qui ne se charge que de l'affichage de données, peu lui importe d'ou elles proviennent,</li>
<li>le composant <code class="language-text">Talks</code> utilisant le <code class="language-text">DataProvider</code> pour obtenir les données et <code class="language-text">TalksView</code> pour l'     afficher <code class="language-text">render={({ data }) =&gt; &lt;TalksView talks={data} /&gt;}</code>.</li>
</ul>
<p>C'est simple, efficace et lisible !</p>
<blockquote>
<p>Il existe une excellente librairie reprenant ce principe de data provider : <a href="https://github.com/jamesplease/react-request">react-request: Declarative HTTP requests for React</a></p>
</blockquote>
<p>Sur cette base, nous pouvons supprimer Redux de notre application.</p>
<iframe src="https://codesandbox.io/embed/o77qv75rmq?module=%2Fsrc%2FApp.js&view=editor" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
<p>Relançons l'analyse de notre projet :</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">❯ cloc services/cra_webapp/src
      16 text files.
      16 unique files.
       0 files ignored.

github.com/AlDanial/cloc v 1.74  T<span class="token operator">=</span>0.04 s <span class="token punctuation">(</span>418.9 files/s, 13404.6 lines/s<span class="token punctuation">)</span>
-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
JavaScript                      15             64              1            442
CSS                              1              0              0              5
-------------------------------------------------------------------------------
SUM:                            16             64              1            447
-------------------------------------------------------------------------------</code></pre></div>
<p>Nous sommes donc passés de 819 lignes de code à <strong>442 lignes</strong>, presque moitié moins. Pas mal !</p>
<h2>Se Passer du Store de Redux</h2>
<p>En l'état, on obtient les données pour chaque page grâce au DataProvider. Mais notre application requière une authentification permettant d'obtenir les informations sur l'utilisateur via un <strong>json-web-token</strong>.<br>
Comment va-t-on pouvoir transmettre ces informations sur l'utilisateur aux différents composants sans le store Redux ?<br>
Et bien en utilisant le <strong>state</strong> de notre composant de plus haut niveau, le <code class="language-text">App.js</code> et en transmettant le <code class="language-text">user</code> comme une <strong>prop</strong> aux composants enfants qui en ont besoin (<code class="language-text">PrivateRoute.js</code>, <code class="language-text">Header.js</code>).</p>
<p>Bref, en faisant du React !</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in App.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Authentication <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./authentication/Authentication'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Header <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./components/Header'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PrivateRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./PrivateRoute'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Talks <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./talks/Talks'</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function-variable function">decodeToken</span> <span class="token operator">=</span> <span class="token parameter">token</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> token <span class="token operator">=</span> window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function-variable function">handleNewToken</span> <span class="token operator">=</span> <span class="token parameter">token</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decodeToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function-variable function">handleLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Router<span class="token operator">></span>
                <span class="token operator">&lt;</span>div<span class="token operator">></span>
                    <span class="token operator">&lt;</span>Header user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> onLogout<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleLogout<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                        <span class="token operator">&lt;</span>PrivateRoute
                            path<span class="token operator">=</span><span class="token string">"/talks"</span>
                            render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                                <span class="token operator">&lt;</span>Talks <span class="token operator">/</span><span class="token operator">></span>
                            <span class="token punctuation">)</span><span class="token punctuation">}</span>
                            user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span>
                        <span class="token operator">/</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>Route
                            path<span class="token operator">=</span><span class="token string">"/login"</span>
                            render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> location <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                                <span class="token operator">&lt;</span>Authentication
                                    location<span class="token operator">=</span><span class="token punctuation">{</span>location<span class="token punctuation">}</span>
                                    onNewToken<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleNewToken<span class="token punctuation">}</span>
                                <span class="token operator">/</span><span class="token operator">></span>
                            <span class="token punctuation">)</span><span class="token punctuation">}</span>
                        <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p>C'est vrai, stocker le <code class="language-text">token</code> dans le <code class="language-text">window.sessionStorage</code> est une <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/"><strong>mauvaise pratique</strong></a>. Mais cela permet pour notre exemple de rapidement mettre en place l'authentification. Cela n'a rien à voir avec la suppression de Redux.</p>
</blockquote>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in PrivateRoute.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * This Route will redirect the user to the login page if needed.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">PrivateRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>
    user <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Route <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Redirect
            to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                pathname<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
                state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> rest<span class="token punctuation">.</span>location <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

PrivateRoute<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in components/Header.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Navigation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Header</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> onLogout <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>header<span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>JavaScript Playground<span class="token punctuation">:</span> meetups<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token punctuation">{</span>user <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Navigation onLogout<span class="token operator">=</span><span class="token punctuation">{</span>onLogout<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Header<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
    onLogout<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>L'application étant très simple, le passage du <code class="language-text">user</code> en <strong>prop</strong> aux enfants n'est pas problématique. Le composant <code class="language-text">Header</code> fait sans doute un peu le <em>passe-plat</em> mais ce n'est pas très pénalisant.</p>
<p>Qu'en est-il pour une application plus conséquente ? Cela peut devenir très pénible. C'est d'ailleur un des cas ou il devient légitime de se poser la question de l'utilisation de Redux !</p>
<p>Mais avant cela, il existe maintenant une solution très simple permettant de transmettre des informations depuis un composant vers un autre composant plus profond du DOM : le <a href="https://reactjs.org/docs/context.html"><strong>Context</strong></a> de React.</p>
<h3>React Context</h3>
<p>La méthode <code class="language-text">React.createContext</code> va nous permettre de générer un :</p>
<ul>
<li><code class="language-text">Provider</code> chargé de <em>distribuer</em> la donnée,</li>
<li><code class="language-text">Consumer</code> qui sera capable de lire la donnée du provider.</li>
</ul>
<blockquote>
<p>On peut noter au passage que le <code class="language-text">Consumer</code> utilise la pattern de <strong>render prop</strong>.</p>
</blockquote>
<p>Reprenons nos trois composants précédents.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in App.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> decode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'jsonwebtoken'</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onLogout</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider
                value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                    user<span class="token punctuation">,</span>
                    onLogout<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleLogout<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">></span>
                <span class="token operator">&lt;</span>Router<span class="token operator">></span>
                    <span class="token operator">&lt;</span>Container<span class="token operator">></span>
                        <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
                            <span class="token operator">&lt;</span>PrivateRoute
                                exact
                                path<span class="token operator">=</span><span class="token string">"/"</span>
                                render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> location <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                                    <span class="token operator">&lt;</span>Home location<span class="token operator">=</span><span class="token punctuation">{</span>location<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
                                <span class="token punctuation">)</span><span class="token punctuation">}</span>
                            <span class="token operator">/</span><span class="token operator">></span>
                        <span class="token operator">...</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in PrivateRoute.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> UserContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">PrivateRouteWithoutContext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>
    user <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Route <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Redirect
            to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                pathname<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
                state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> rest<span class="token punctuation">.</span>location <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

PrivateRouteWithoutContext<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">PrivateRoute</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>PrivateRouteWithoutContext user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// in components/Header.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> UserContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Navigation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Navigation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">HeaderWithoutContext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> onLogout <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>header<span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>JavaScript Playground<span class="token punctuation">:</span> meetups<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token punctuation">{</span>user <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Navigation onLogout<span class="token operator">=</span><span class="token punctuation">{</span>onLogout<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

HeaderWithoutContext<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
    onLogout<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Header</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
            <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> onLogout <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>HeaderWithoutContext user<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">}</span> onLogout<span class="token operator">=</span><span class="token punctuation">{</span>onLogout<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Le <strong>Context</strong> de React est un moyen simple de <em>télétransporter</em> directement de la donnée d'un composant <em>N</em> de l'application à n'importe quel composant enfant <em>N-x</em>.</p>
<h2>Alors, Avec ou Sans Redux ?</h2>
<p>Redux devient intéressant dès lors qu’un projet atteint un certain niveau de complexité. Mais par expérience, c’est rarement une bonne idée que de préjuger du degré d’intrication de son projet ! Et je préfère de loin garder les choses simples à me dire dès le début : «<em>Chouette, je vais faire un truc hyper compliqué</em>». Cela me rappelle il y a quelques années où pour démarrer un projet en Php, on utilisait systématiquement Symfony alors que Silex permettait de démarrer beaucoup plus simplement et rapidement.  </p>
<p>Il n’en reste pas moins que tout comme Symfony, l’utilisation de Redux peut devenir un choix très judicieux.  <strong>C’est juste qu’il est prématuré de prendre cette décision au démarrage du projet.</strong></p>
<p>Ce n'est d'ailleurs pas une nouveauté 😄</p>
<blockquote class="twitter-tweet" data-lang="fr"><p lang="en" dir="ltr">You Might Not Need Redux.</p>&mdash; Dan Abramov (@dan_abramov) <a href="https://twitter.com/dan_abramov/status/777983404914671616">19 septembre 2016</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Au delà de ces considérations un peu théoriques, il me semble aussi qu’il existe des effets bénéfiques au fait de ce passer de Redux.</p>
<p>En premier lieu, on se concentre plus sur React ! En codant le second exemple de ce post, j’ai retrouvé le plaisir de construire une application uniquement à partir de briques de composants : c’est comme de jouer aux Lego. L’utilisation des <strong>render prop</strong> permet la re-utilisation de code au sein du projet tout en conservant cette logique d’imbrication de composants de React. C’est un pattern puissant, moins magique que les <a href="https://reactjs.org/docs/higher-order-components.html">HOC</a>, qui pourra le moment venu s’adapter à l’éventuelle implémentation de Redux. J’en veux pour preuve <a href="https://marmelab.com/blog/2018/05/18/react-admin-2-0.html">react-admin 2.0</a> qui dissocie complètement <a href="https://github.com/marmelab/react-admin/tree/master/packages/ra-ui-materialui">la partie UI</a> de <a href="https://github.com/marmelab/react-admin/tree/master/packages/ra-core">la logique applicative</a> grâce aux render props.</p>
<p>Enfin, cela semble l’orientation prise par l’équipe de React qui avec la nouvelle version de l’API Context offre la possibilité de mettre en place un store global facilement partageable sans adopter Redux.</p></div><div class="just-comments" data-apikey="cdfe5295-0bb5-4662-b98b-11fcfc0eaa83"></div></div></div></header></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-129388047-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-129388047-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"avec-ou-sans-redux-0f5","path":"/avec-ou-sans-redux"};window.dataPath="500/path---avec-ou-sans-redux-0-f-5-044-B1Q7yjhwRp4bpnEaLa9yERDGMoc";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-6c5376e06f2d7e34c5c3.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-a3c7316724bb72f3a7bc.js"],"component---src-pages-about-js":["/component---src-pages-about-js-a155a3467ee0e3bf1d29.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0392324a975bb04d2abd.js"],"pages-manifest":["/pages-manifest-f93a4abd6189ec61c40e.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-a3c7316724bb72f3a7bc.js" async=""></script><script src="/2-0e0f7c0717f48b96baf5.js" async=""></script><script src="/1-2dea483b5ed5e468183a.js" async=""></script><script src="/styles-7d82cead6d54fb5cd7e1.js" async=""></script><script src="/app-6c5376e06f2d7e34c5c3.js" async=""></script><script src="/webpack-runtime-e6f938376c01eb7ce981.js" async=""></script></body></html>