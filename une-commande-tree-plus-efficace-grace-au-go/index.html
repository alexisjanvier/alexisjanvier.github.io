<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-c4025eb114f7f31c9d2c.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-831aa2f93fff98ce25aa.js" as="script"/><link rel="preload" href="/path---une-commande-tree-plus-efficace-grace-au-go-73f1a2587d8c9c5c27d5.js" as="script"/><link rel="preload" href="/app-9e38e08a8277d541daca.js" as="script"/><link rel="preload" href="/commons-273a973d0309c562769c.js" as="script"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.5 'PT Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'PT Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:hsla(0,0%,0%,0.9);font-family:'Oswald',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}ul{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:0.85rem;line-height:1.5rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1rem;line-height:1.5rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0.9375rem;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1.1487rem;line-height:1.5rem;border-left:0.5625rem solid #292d35;color:hsla(0,0%,0%,0.65);font-style:italic;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.5rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.5rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}li > ul{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.5rem / 2);}code{font-size:0.85rem;line-height:1.5rem;}kbd{font-size:0.85rem;line-height:1.5rem;}samp{font-size:0.85rem;line-height:1.5rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:calc(0.75rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#292d35;text-decoration:none;text-shadow:.03em 0 #fff,-.03em 0 #fff,0 .03em #fff,0 -.03em #fff,.06em 0 #fff,-.06em 0 #fff,.09em 0 #fff,-.09em 0 #fff,.12em 0 #fff,-.12em 0 #fff,.15em 0 #fff,-.15em 0 #fff;background-image:linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 1px, #292d35 1px, #292d35 2px, rgba(0, 0, 0, 0) 2px);}a:hover,a:active{text-shadow:none;background-image:none;}h1,h2,h3,h4,h5,h6{margin-top:3rem;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.5rem;color:hsla(0,0%,0%,0.8);font-style:normal;font-weight:400;}blockquote cite:before{content:"— ";}@media only screen and (max-width:480px){html{font-size:106.25%;line-height:1.45;}blockquote{border-left:0.28125rem solid #292d35;color:hsla(0,0%,0%,0.59);padding-left:0.84375rem;font-style:italic;margin-left:-1.125rem;margin-right:0;}}</style><link href="//fonts.googleapis.com/css?family=Oswald:700|PT+Sans:400,400i,700" rel="stylesheet" type="text/css"/><title data-react-helmet="true">Une commande tree plus efficace grâce au Go</title><meta data-react-helmet="true" name="author" content="Àlexis Janvier"/><meta data-react-helmet="true" name="description" content="Peut-on facilement et rapidement améliorer la classique commande `tree` grâce au langage Go ? Nancy étant dans les cartons, c&#x27;est Paris qui s&#x27;y colle pour cette journée de Hackday."/><meta data-react-helmet="true" name="keywords" content="go,tutorial"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style id="gatsby-inlined-css">header h3,header h5{display:inline-block;padding-right:.5rem;margin-top:0}header a{text-shadow:none;background-image:none;text-decoration:none;vertical-align:middle}header a:hover{color:red}header a img{vertical-align:middle}.blog-list h2,.blog-list h4{margin-bottom:.5rem}.blog-list h4{font-style:italic;margin-top:0}.blog-list h4 span{display:inline-block;color:grey;font-size:.8rem}.postIntro h1{font-size:2.5rem;width:100%;text-align:center;margin-top:1rem;margin-bottom:.5rem}.postIntro p.tags{font-size:.8rem;color:gray;margin:0;text-align:center}.postIntro p.date{margin:0 0 1rem;text-align:center}.postIntro p.intro{margin-top:1.5rem;font-style:italic}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style></head><body><div id="___gatsby"><div style="margin:0 auto;max-width:1000px;padding:1.25rem 1rem;" data-reactroot="" data-reactid="1" data-react-checksum="-438530397"><!-- react-empty: 2 --><header style="margin-bottom:1.5rem;" data-reactid="3"><a href="/" data-reactid="4"><h3 data-reactid="5">This is not &#x27;Nam.</h3><h5 data-reactid="6">This is my blog. There are rules.</h5></a><ul style="list-style:none;float:right;" data-reactid="7"><li style="display:inline-block;margin-right:1rem;" data-reactid="8"><a href="/" data-reactid="9">Blog</a></li><li style="display:inline-block;margin-right:1rem;" data-reactid="10"><a href="/about/" data-reactid="11">About</a></li><li style="display:inline-block;margin-right:1rem;" data-reactid="12"><a href="https://twitter.com/alexisjanvier" data-reactid="13"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAjcAAAI3AfcGRMIAAAAHdElNRQfhCQEKGCQX757NAAACjElEQVRIx62VX0hTURzHP/e6NRkYLREcrLeCfFDBGL4UiWGJL+sP9FLkQ4FR7MGHhHTe251OqRBJX6qXIBDCelCQIAYS9CSVBCsHFT3EaIIxs8HYmnp72N28/zYn+Hs653fO93Pv7/x+5/wEFatNu9Y71QBNePECSZLEhXnPYjBn3SuYAWPevMQV6my4aWac4cFkBYBSS4h+3JS3DJOMyllbgNLIHO3sbkucl1ctgJHm7df4qpADJMSe4ZgBoDTyvmo5QAJ/4S9ELfa5PcnBx5xSWwIQqhj7Jo+Fy5wRBvgBQIy/QDshLYQxb/67dvKPOEWbSZ7inPyhMHxQl72lRnHzrpAR59HBpAh5qZS4Wbr4aALcLsphIC3d5w+XeAOAOy+BMOVKrZXK5oicmHalJAZwaJ4N2YOp1sIB9ZW2nj7cIK536qruJARz8pDYxlM2APhslo+cUGdL+Lr1TlEN6FZ7X9YADMfkPhqFs/SzYD7RbT8HdmZqwEGTbjUWv8GTwlDOEiVqk5MWw6zJgVc3fSEt71oBrYaZVzQAru8qF2g2A/TWp1ysrB89br7oIvr7XcNzZWK8oTxgK2JyJI0AyPDw7lo5udLNBSsgbnA08AzBXj7tYsrijIvCvMnVrSyH7yg2dzM1yDHLmc6LnkXSJm+r2oJo3qqEkCzMtGfREcwpM9wE4Be/WeELC/In477x+n8T9NpENRPMOcAZzl/DDRxklkn5p+nLh7jKPept5BlnWHvSlFGGNOcmUVaEb3xVt/Dh4zRdOMskJSKHioBa3lb1HuttiQ45u1+PKsirYg+J6uViT7EzlNI1HMPPUpU/7y92BfT5llfpIEKmojhDhI6dvrTfzbVoe2nv/wH5+trdc83aGwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wOS0wMVQxMDoyNDozNiswMjowMORVb1wAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDktMDFUMTA6MjQ6MzYrMDI6MDCVCNfgAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAA10RVh0VGl0bGUAVHdpdHRlcpMAsEgAAABXelRYdFJhdyBwcm9maWxlIHR5cGUgaXB0YwAAeJzj8gwIcVYoKMpPy8xJ5VIAAyMLLmMLEyMTS5MUAxMgRIA0w2QDI7NUIMvY1MjEzMQcxAfLgEigSi4A6hcRdPJCNZUAAAAASUVORK5CYII=" data-reactid="14"/></a></li><li style="display:inline-block;margin-right:1rem;" data-reactid="15"><a href="https://github.com//alexisjanvier" data-reactid="16"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAjcAAAI3AfcGRMIAAAAHdElNRQfhCQEKFycJftO4AAAC2ElEQVRIx62VTUhUURTHf/c10/hJ+VH6wtqVWhi0qHEhItIiKhzbtCncRFSLWQhRJubrjTqLXAjZoqKPlVA7B0JXCUIIOqiLIkcNizRGEfxoBptpdF6LefPmOTM5Cp3NOx/3/7/3nHfPPUIjVXptq/Wag0pkZMCPnynhKRhyhlPXimQCtxxp5xr5aXgD9Fldrf4dCNQs2mgmh3/LBj10KqG0BGop/djZWZYpZoxGZTHukOJKRxVe7CyTi4O3bKTZ+zV25TAj2PF2VCWdQC3FSxkwrVQAPM7/7RRLzO2bs6yFiigWR7Vx5TuA+pIbwAJnY6ew6Ln3U2be7l4At2GsM8eYseO0BlBGv1qnhOIptGXMPSFR/WunTa+BW6bZCE9mwmuvmNfVZrcMEkTajR8XsrRkIlDWxANdzYm0g3hiW1k2rs0L5VbmHHptK8FY7QgUHpJW6023bj4zHJxhvuhq/mq9pDlMsbVdFtK4JZpDojLhF7m7JMgztEoJ2VThwj0TyBZkQCPICjMs7ZLgJ0EKKMGCHO+FLbKpoEE9kRmtXmCdTfbHLqF4NMNxU/QH9kSnpYWfY4Aiw5yV2P5AHGPCdWnH3T+Y4OC3MEWtbgQZ5DKy9l79iEcajM4qfwxglnQm6uAKySlOScKTqK0YphofUEN39DPXE+vEjegI91PgCI9UMEQgbmrd0pbUxCwAXuVNYqH2HF+ajAIFQ5IzTJ/hyI6+s36lDid3qEVTs0C9C2qOssl4GoI+Z9gCVlekyejHU+FnttstT3XrJBPkAdUM8SsFvmF1gQStfnpM7qvhb6pP9bluAqd1Xw0kEjWkp9Uff5E6GTUFDlBOuVYEokT3HOm1kTxARukEnUAJ0chCaoqaiGsrgqxtoQUaY9PBmAsdVdGBbQ/rOsMcZJDzTNJAIcVmuHTx4Sf9R+5xsMQOn26wgLJIHV1pRsq2ytNFnblb/u9wjctexvtf2qD0QeZRdFEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTctMDktMDFUMTA6MjM6MzkrMDI6MDDwwQTMAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE3LTA5LTAxVDEwOjIzOjM5KzAyOjAwgZy8cAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAMdEVYdFRpdGxlAEdpdEh1YlTKy1sAAABXelRYdFJhdyBwcm9maWxlIHR5cGUgaXB0YwAAeJzj8gwIcVYoKMpPy8xJ5VIAAyMLLmMLEyMTS5MUAxMgRIA0w2QDI7NUIMvY1MjEzMQcxAfLgEigSi4A6hcRdPJCNZUAAAAASUVORK5CYII=" data-reactid="17"/></a></li></ul></header><div data-reactid="18"><!-- react-empty: 19 --><div class="postIntro" data-reactid="20"><h1 data-reactid="21">Une commande tree plus efficace grâce au Go</h1><p class="date" data-reactid="22"><!-- react-text: 23 -->Publié le <!-- /react-text --><!-- react-text: 24 -->30 octobre 2014<!-- /react-text --></p></div><div data-reactid="25"><p>Chez Marmelab, un hackday c'est comme une semaine d'intégration, mais sur une journée : une hypothèse définie le matin, un produit fonctionnel et testé le soir sur une nouvelle techno ; et aussi un post de blog pour en parler, dans la nuit. Le plus, c'est qu'on est par équipes.
Pour ce hackday un peu spécial, pour cause de Hack Dayménagement à Nancy, l'équipe parisienne planche sur la reproduction, voir l'amélioration de la commande <a href="http://fr.wikipedia.org/wiki/Commande_tree">tree</a> bien connue.</p>
<h2>Mise en place de l'environnement de développement</h2>
<p>Première étape pour cette journée de découverte du Go : la mise en place de l'environnement de développement. Après l'<a href="https://golang.org/doc/install">installation</a> proprement dite, il s'agit de configurer le <em>workspace</em>, soit un répertoire contenant trois sous-répertoires :</p>
<ul>
<li><strong><em>bin</em></strong> qui va contenir les exécutables finaux de nos programmes Go,</li>
<li><strong><em>pkg</em></strong> qui va contenir les objets de package utiles aux commandes,</li>
<li><strong><em>src</em></strong> qui va contenir les fichiers sources des packages (c'est le plus souvent dans ce dossier que l'on va mettre notre propre code).</li>
</ul>
<p>Ce répertoire doit être ajouté à une variable d'environnement GOPATH. Donc si classiquement on définit un répertoire Go à la racine de notre répertoire utilisateur, on va faire un  :</p>
<div class="gatsby-highlight" data-language="text">
      <pre class="language-text"><code class="language-text">export GOPATH=$HOME/Go
export PATH=$PATH:$GOPATH/bin</code></pre>
      </div>
<p>Ce qui est génial, c'est que du coup, lorsque l'on va compiler un programme Go (avec un <code class="language-text">Go install path/to/pgm</code>), il sera directement accessible depuis la ligne de commande.</p>
<p>Nativement, Go s'installe avec un programme permettant de corriger le formatage d'un fichier.Go : <a href="https://golang.org/cmd/gofmt/">gofmt</a>. Pour ceux travaillant avec Sublime Text, ne reste plus qu'à installer et configurer le plugin <a href="https://github.com/DisposaBoy/GoSublime">SublimeGo</a> pour pouvoir commencer à coder sur de bonnes bases.</p>
<h2>Première implémentation : reproduire tree</h2>
<p>Notre premier objectif a consisté en la reproduction de l'affichage "en arbre" du contenu d'un répertoire. Pour cela, nous avons utilisé les outils de la librairie standard du Go (<code class="language-text">flag</code>, <code class="language-text">io/ioutil</code> et <code class="language-text">strings</code>), ainsi qu'une programmation très procédurale. Du coup, nous avons assez rapidement atteint notre premier objectif.</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"flag"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
    <span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    path <span class="token operator">:=</span> <span class="token string">"./"</span>
    <span class="token keyword">if</span> userpath <span class="token operator">:=</span> flag<span class="token punctuation">.</span><span class="token function">Arg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> userpath <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>
        path <span class="token operator">=</span> userpath
    <span class="token punctuation">}</span>

    <span class="token function">displayDir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">displayDir</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> previousIndent <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    files<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    nbElements <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    indent <span class="token operator">:=</span> <span class="token string">"├──"</span>
    nextIndent <span class="token operator">:=</span> <span class="token string">" │       "</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
        <span class="token keyword">if</span> i <span class="token operator">==</span> nbElements<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
            indent <span class="token operator">=</span> <span class="token string">"└──"</span>
            nextIndent <span class="token operator">=</span> <span class="token string">"       "</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>path<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            nextPath <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>previousIndent<span class="token punctuation">,</span> indent<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> previousIndent
            s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> nextIndent
            <span class="token function">displayDir</span><span class="token punctuation">(</span>nextPath<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>previousIndent<span class="token punctuation">,</span> indent<span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">displayIndent</span><span class="token punctuation">(</span>previousIndent <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>nextIndent <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>previousIndent<span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">}</span>
    nextIndent <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<img src="/images/blog/gotreev0.png" class="medium" >
<h2>Seconde implémentation : ajouter de l'interactivité</h2>
<p>Une fois ce premier objectif atteint, nous devions décider si :</p>
<ul>
<li>nous allions continuer à reproduire la commande initiale tree (mise en place des nombreuses options),</li>
<li>ou bien si nous allions dévier de la commande originale pour y ajouter de l'interactivité.</li>
</ul>
<p>C'est cette seconde option qui a été choisie, et ce grâce à l'utilisation de la bibliothèque <a href="https://github.com/nsf/termbox-Go">termbox-Go</a>, implémentation en Go de la librairie <a href="https://code.google.com/p/termbox/">termbox</a>.</p>
<p>Cette seconde implémentation fut l'occasion d'un premier refactoring, et donc d'une première approche de l'organisation du code. Nous avons opté pour la mise en place de notre package <code class="language-text">gotree</code> au niveau de la racine de notre répertoire de travail, et nous avons écrit notre script principal <code class="language-text">main</code> dans un sous répertoire cmd.</p>
<img src="/images/blog/gotreeorga.png" class="small" >
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/marmelab/gotree"</span>
<span class="token punctuation">)</span></code></pre>
      </div>
<p>Nous aurions pu au contraire mettre notre script principal <code class="language-text">main</code> à la racine de notre répertoire de travail, et l'ensemble des autres fichiers dans un sous-répertoire au sein d'un package nommé par exemple gotree<em>tools, importés dans notre script <code class="language-text">main</code> via un import 'github.com/marmelab/gotree/gotree</em>tools'.</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/marmelab/gotree/gotree_tools"</span>
<span class="token punctuation">)</span></code></pre>
      </div>
<p>Suite à cette seconde implémentation basée sur <code class="language-text">termbox</code>, nous avons maintenant une commande console s'éloignant de tree (nous n'avons plus de visualisation en arbre des répertoires et sous-répertoires) mais interactive.</p>
<center>
<div class="video-container">
<iframe src="//player.vimeo.com/video/110195230" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
</div>
</center>
<h2>Du code testable : passage en POO</h2>
<p>Avant d'aller plus loin, il était temps de se pencher un peu sur les tests. En effet, notre méconnaissance et notre découverte du langage par tâtonnement a été une bonne excuse pour ne pas faire du TDD dès le début. Résultat, même avec un code refactorisé, notre code n'était pas testable à cette étape.</p>
<p>A propos des tests, Go dispose de base d'une <a href="http://golang.org/pkg/testing/">bibliothèque de tests</a> et l'on trouve un grand nombre de projets permettant d'étendre ces outils de tests. Nous avons choisi pour gotree le projet <a href="https://github.com/stretchr/testify">http://golang.org/pkg/testing/</a>, ajoutant aussi bien des fonctionnalités d'assertion non présentes en natif que des outils de mocks.
Et c'est ce besoin de réaliser un mock de la bibliothèque termbox qui nous a obliger à refactoriser notre code.</p>
<p>Nous avons alors converti nos fonctions en objets, plus précisement en structures, ce qui diffère sensiblement d'un object en PHP ou Java par exemple.
Nous nous sommes confrontés à l'utilisation des <a href="https://golang.org/doc/effective_go.html#interfaces">interfaces en Go</a>, très différentes des interfaces PHP avec lesquelles nous étions plus familiers.</p>
<p>Voici un extrait de notre commande <code class="language-text">main</code> après le passage en POO:</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token comment">// Notre objet Termbox implémente l'interface Screen</span>
<span class="token keyword">var</span> screen gotree<span class="token punctuation">.</span>Screen <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>gotree<span class="token punctuation">.</span>Termbox<span class="token punctuation">)</span>
<span class="token comment">// L'objet Screen est inclu dans le Displayer</span>
displayer <span class="token operator">:=</span> <span class="token operator">&amp;</span>gotree<span class="token punctuation">.</span>Displayer<span class="token punctuation">{</span>screen<span class="token punctuation">}</span>

displayer<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    displayer<span class="token punctuation">.</span><span class="token function">Terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

navigator <span class="token operator">:=</span> gotree<span class="token punctuation">.</span><span class="token function">NewNavigator</span><span class="token punctuation">(</span>displayer<span class="token punctuation">,</span> rootPath<span class="token punctuation">)</span>
navigator<span class="token punctuation">.</span><span class="token function">InitDir</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">)</span></code></pre>
      </div>
<p>Go possède quelques particularités en ce qui concerne l'écriture des structures, en voici quelques unes.</p>
<p>Vous avez peut être noté la syntaxe, quelque peu scolaire, de décalaration de la variable <code class="language-text">screen</code> :</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">var</span> screen gotree<span class="token punctuation">.</span>Screen <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>gotree<span class="token punctuation">.</span>Termbox<span class="token punctuation">)</span></code></pre>
      </div>
<p>La syntaxe raccourcie <code class="language-text">:=</code> est habituellement utilisée, nous aurions pu écrire ceci:</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go">screen <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>gotree<span class="token punctuation">.</span>Termbox<span class="token punctuation">)</span></code></pre>
      </div>
<p>Ces deux codes semblent identiques, et en effet se comportent de la même façon, mais une subtilité persiste.
L'interface <code class="language-text">Screen</code> comporte 4 méthodes. En Go, comme dans la plupart des autres langages, rien ne nous empèche de rajouter des méthodes.
Mais attention, en Go, si vous avez déclaré votre structure à l'aide de la première syntaxe, le compilateur de Go va vous indiquer que cette nouvelle méthode, que vous essayez d'appeler sur votre variable, n'existe pas.</p>
<p>Une autre particularité d'une structure consiste à lui injecter une autre structure en paramètre sans préciser de nom de propriété dans laquelle l'inclure.</p>
<p>Ce sont des <a href="https://golang.org/ref/spec#Struct_types">propriétés anonymes en Go</a> qui ressemblent à une forme d'héritage. Il s'agit d'une forme de composition de classe particulière : <a href="http://golang.org/doc/effective_go.html#embedding">l'Embedding</a>.
Voici par exemple un extrait de notre structure <code class="language-text">Displayer</code> :</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Displayer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Screen
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>d Displayer<span class="token punctuation">)</span> <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    d<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>On peut voir que le <code class="language-text">Displayer</code> fait appel à une méthode <code class="language-text">Flush()</code> qui n'est disponible que dans la structure <code class="language-text">Screen</code>, un peu déroutant pour nous au début.</p>
<p>Pour finir, il y a plusieurs façons d'instantier une structure en Go.</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go">display <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>gotree<span class="token punctuation">.</span><span class="token function">Displayer</span><span class="token punctuation">(</span>screen<span class="token punctuation">)</span><span class="token punctuation">)</span>
display <span class="token operator">=</span> <span class="token operator">&amp;</span>gotree<span class="token punctuation">.</span>Displayer<span class="token punctuation">{</span>screen<span class="token punctuation">}</span>

<span class="token comment">// A l'aide d'une Factory</span>
<span class="token keyword">func</span> <span class="token function">NewDisplayer</span><span class="token punctuation">(</span>screen Screen<span class="token punctuation">)</span> <span class="token operator">*</span>Displayer <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Displayer<span class="token punctuation">{</span>screen<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
display <span class="token operator">=</span> <span class="token function">NewDisplayer</span><span class="token punctuation">(</span>screen<span class="token punctuation">)</span></code></pre>
      </div>
<p>Toutes trois retournent le même résultat.</p>
<h2>Ecriture des tests</h2>
<p>Voici le test d'une méthode de notre structure <code class="language-text">Navigator</code>:</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">package</span> gotree

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/nsf/termbox-Go"</span>
    <span class="token string">"github.com/stretchr/testify/assert"</span>
    <span class="token string">"github.com/stretchr/testify/mock"</span>
    <span class="token string">"testing"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> DummyScreen <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    mock<span class="token punctuation">.</span>Mock
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ds <span class="token operator">*</span>DummyScreen<span class="token punctuation">)</span> <span class="token function">Clear</span><span class="token punctuation">(</span>fg<span class="token punctuation">,</span> bg termbox<span class="token punctuation">.</span>Attribute<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    args <span class="token operator">:=</span> ds<span class="token punctuation">.</span><span class="token function">Called</span><span class="token punctuation">(</span>fg<span class="token punctuation">,</span> bg<span class="token punctuation">)</span>

    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ds <span class="token operator">*</span>DummyScreen<span class="token punctuation">)</span> <span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    args <span class="token operator">:=</span> ds<span class="token punctuation">.</span><span class="token function">Called</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ds <span class="token operator">*</span>DummyScreen<span class="token punctuation">)</span> <span class="token function">SetCell</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token builtin">int</span><span class="token punctuation">,</span> ch <span class="token builtin">rune</span><span class="token punctuation">,</span> fg<span class="token punctuation">,</span> bg termbox<span class="token punctuation">.</span>Attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ds<span class="token punctuation">.</span><span class="token function">Called</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> fg<span class="token punctuation">,</span> bg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>ds <span class="token operator">*</span>DummyScreen<span class="token punctuation">)</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args <span class="token operator">:=</span> ds<span class="token punctuation">.</span><span class="token function">Called</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TestInitDir</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert <span class="token operator">:=</span> assert<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>

    screen <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>DummyScreen<span class="token punctuation">)</span>
    displayer <span class="token operator">:=</span> <span class="token operator">&amp;</span>Displayer<span class="token punctuation">{</span>screen<span class="token punctuation">}</span>
    navigator <span class="token operator">:=</span> <span class="token function">NewNavigator</span><span class="token punctuation">(</span>displayer<span class="token punctuation">,</span> <span class="token string">"fake"</span><span class="token punctuation">)</span>

    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"Clear"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"Flush"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"SetCell"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    screen<span class="token punctuation">.</span><span class="token function">On</span><span class="token punctuation">(</span><span class="token string">"Size"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">// assert equality</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>currentLine<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"currentLne is 0 on instantiation"</span><span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> <span class="token string">"fake"</span><span class="token punctuation">,</span> <span class="token string">"rootPath is set to new value on instantiation"</span><span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>currentPath<span class="token punctuation">,</span> <span class="token string">"fake"</span><span class="token punctuation">,</span> <span class="token string">"currentPath is set to rootPath on instantiation"</span><span class="token punctuation">)</span>

    navigator<span class="token punctuation">.</span>currentLine <span class="token operator">=</span> <span class="token number">3</span>
    navigator<span class="token punctuation">.</span><span class="token function">InitDir</span><span class="token punctuation">(</span><span class="token string">"fake/dir"</span><span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>currentLine<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"currentLine is reseted after InitDir() call"</span><span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>currentPath<span class="token punctuation">,</span> <span class="token string">"fake/dir"</span><span class="token punctuation">,</span> <span class="token string">"currentPath gets the the new value given by InitDir()"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>Nous avons retrouvé dans l'écriture des tests une façon de procéder assez similaire à d'autres langages de programmation.
La librairie de mock est simple d'utilisation et la librairie d'assertion est tout à fait standard.</p>
<h2>Utilisation des Goroutines</h2>
<p>Afin de finir cette journée de hack sur une des particularités de Go, nous avons implémenter <em>in extremis</em> les goroutines, qui à ce stade, n'apportent pas grand chose en terme de performance.</p>
<div class="gatsby-highlight" data-language="go">
      <pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">InitDir</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token string">""</span> <span class="token operator">==</span> rootPath <span class="token punctuation">{</span>
        rootPath <span class="token operator">=</span> path
    <span class="token punctuation">}</span>

    <span class="token function">displayStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">displayBreadcrumb</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> File<span class="token punctuation">)</span>
    Go <span class="token function">fetchFiles</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> c<span class="token punctuation">)</span>

    first <span class="token operator">:=</span> <span class="token boolean">true</span>
    i <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> c <span class="token punctuation">{</span>
        <span class="token function">displayLine</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> first<span class="token punctuation">)</span>

        first <span class="token operator">=</span> <span class="token boolean">false</span>
        i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>

    <span class="token function">displayStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    currentPath <span class="token operator">=</span> path
    currentLine <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">fetchFiles</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> fs <span class="token keyword">chan</span> File<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    files <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>File<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> file File
    dirFiles<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> dirFiles <span class="token punctuation">{</span>
        <span class="token keyword">if</span> f<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        file <span class="token operator">=</span> File<span class="token punctuation">{</span>f<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        fs <span class="token operator">&lt;-</span> file

        files <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token comment">// do something</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h2>Conclusion</h2>
<p>Une journée, c'est très court pour réussir à fournir un produit fonctionnel sur une nouvelle techno ou un nouveau langage. Il faut savoir ne pas être trop ambitieux sur la définition du produit. Et nous ne l'étions pas en début de journée, réussissant assez vite à reproduire le fonctionnement de base de la commande <code class="language-text">tree</code> (première implémentation).
Mais nous avons ensuite été un peu trop ambitieux en voulant ajouter une interactivité qui n'a finalement que dénaturé le produit. Reste que cela a été l'occasion d'aborder plus sérieusement le Go via la POO et les tests, ce qui était aussi l'un des objectifs de cette journée de hackday, loin des cartons.</p>
<p><strong><em>Post-scriptum</em></strong> : <em>le code de cette journée est <a href="https://github.com/marmelab/gotree">disponible sur Github</a>.</em></p></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-9e38e08a8277d541daca.js","107818501498521":"component---src-templates-blog-post-js-831aa2f93fff98ce25aa.js","263791100135453":"component---src-pages-about-js-2ead366e119f00e0cdd1.js","35783957827783":"component---src-pages-index-js-890c8a5192d2cbec35bc.js","60335399758886":"path----b67ec03a2eef0f074187.js","279445920532214":"path---mobileinsight-une-semaine-avec-angularjs-ionic-et-phonegap-a586a82fc0114e601a16.js","150851776216855":"path---road-to-caen-le-projet-c2d71750cade2d45dd41.js","218094895093905":"path---une-console-sous-windows-b961a98af5918f3c2d68.js","100822885102543":"path---deploiement-continu-vers-s-3-23e202914ff1e1225d9c.js","86129371359560":"path---is-it-snobbery-to-want-a-real-console-on-windows-cca91684aeb8c2ede36c.js","163865424693099":"path---yarn-baae6b9bf38164c07dc0.js","92891156285265":"path---bind-user-on-docker-container-11e01054da25e4a17c6e.js","218583586713429":"path---gasby-avec-docker-7428361bcfacf503052d.js","1956946496716":"path---du-php-au-go-une-semaine-pour-realiser-un-produit-fonctionnel-c44bfd907779cecf2dad.js","31427655937549":"path---une-console-plus-graphique-avec-nodejs-et-d-3-js-be0387b83319476bc82e.js","228858649057877":"path---une-commande-tree-plus-efficace-grace-au-go-73f1a2587d8c9c5c27d5.js","169354898916999":"path---bilan-du-forum-php-2014-le-php-langage-de-linnovation-043009bf7a4a1103e17f.js","265721139490156":"path---decouvrir-les-service-workers-313d411b470d18b431ef.js","1612247669354":"path---5-e-edition-du-printemps-agile-de-caen-27ded77587aa8156fd44.js","28208346465457":"path---monorepo-41a909164dca3b7b6c4d.js","52473784306371":"path---bootstrapping-du-projet-en-es-6-cc9ad1bc1de1b5fabf08.js","117258079593921":"path---retour-sur-une-annee-en-teletravail-a-plein-temps-2f24a820ef1c0dc0afae.js","172608284757503":"path---rr-4-ssr-redux-code-splitting-dans-un-bateau-0ebb7280aa23161a8d0a.js","13552346346882":"path---running-react-router-v-4-redux-saga-ssr-and-code-splitting-together-10a9bbcf19c5d71ea589.js","3093294421951":"path---eslint-prettier-515c182e9aae46aba9aa.js","261154270709379":"path---avec-ou-sans-redux-d05f02e40702aff21abb.js","273950069227526":"path---about-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-ec588be5e08878b91db0.js","114276838955818":"component---src-layouts-index-js-c4025eb114f7f31c9d2c.js"}/*]]>*/</script><script>/*<![CDATA[*/["/commons-273a973d0309c562769c.js","/app-9e38e08a8277d541daca.js","/path---une-commande-tree-plus-efficace-grace-au-go-73f1a2587d8c9c5c27d5.js","/component---src-templates-blog-post-js-831aa2f93fff98ce25aa.js","/component---src-layouts-index-js-c4025eb114f7f31c9d2c.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>