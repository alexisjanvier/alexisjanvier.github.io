<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstraping your dates &middot; alexisjanvier.net</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.15-DEV" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Bootstraping your dates &middot; alexisjanvier.net">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Bootstraping your dates &middot; alexisjanvier.net">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://localhost:1313//css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="alexisjanvier.net" href="http://localhost:1313//index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://localhost:1313/">alexisjanvier.net</a></h1>
            <h2 class="brand-tagline"> This is not &#39;Nam. This is my blog. There are rules. </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/alexisjanvier"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/alexisjanvier "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://localhost:1313//index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">22 Sep 2015, 09:20</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://localhost:1313/notes/bootstrapingTime/" class="post-title">Bootstraping your dates</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-share">
                        <div class="post-share-links">
                            <h4 style="">Share</h4>
                            <a href="#" data-type="facebook" data-url="http://localhost:1313/notes/bootstrapingTime/" data-title="Bootstraping your dates" data-description="" data-media="" class="prettySocial fa fa-facebook"></a>
                            <a href="#" data-type="googleplus" data-url="http://localhost:1313/notes/bootstrapingTime/" data-description="" class="prettySocial fa fa-google-plus"></a>
                            
                            
                        </div>
                    </div>
                    <div class="post-description">
                        

<h1 id="pourquoi:e4f693dbd06f39f7a3b961939b760122">Pourquoi</h1>

<p>Importance de la cohérence des dates. Exemple transaction.
Sujet classique, mais je me suis fait avoir.
Donc, pour ne pas risquer de perdre de la data, bien penser tout cela dès le début du projet.
Ici projet bakend node postgres, API. Et front JS</p>

<h1 id="format-d-échange-iso-6801:e4f693dbd06f39f7a3b961939b760122">Format d&rsquo;échange ISO 6801</h1>

<h2 id="le-format:e4f693dbd06f39f7a3b961939b760122">Le format</h2>

<p>Quelle format utiliser. Tant qu&rsquo;à faire autant partir sur le plus standard de tous : ISO 6801.
La Syntaxe
Les timezones et l&rsquo;UTC</p>

<h1 id="configuration-du-postrgres:e4f693dbd06f39f7a3b961939b760122">Configuration du Postrgres</h1>

<p>Nous allons donc stocker les dates dans une DB. Ce serveur sera donc la référence, mais on ne sera pas ou il est.
=&gt; On va donc le mettre en UTC</p>

<h2 id="serveur-en-utc:e4f693dbd06f39f7a3b961939b760122">Serveur en UTC</h2>

<p>Configuration du Postgres (et du serveur qui le support)
Quid du service amazon ?</p>

<h2 id="champs-timestamp-avec-ou-sans-time-zone:e4f693dbd06f39f7a3b961939b760122">Champs timestamp avec ou sans time zone</h2>

<p>Configuration des champs dates</p>

<h2 id="convertir-au-besoin:e4f693dbd06f39f7a3b961939b760122">Convertir au besoin</h2>

<p>Et si j&rsquo;importe des données depuis un autre serveur possédent une autre timezone.
Et si je récupère des datas sans timezone ?</p>

<h2 id="export-vers-un-serveur-possédant-une-autre-timezone:e4f693dbd06f39f7a3b961939b760122">export vers un serveur possédant une autre timezone</h2>

<p>Et si je bouge mon serveur dans une autres timezone ?</p>

<h2 id="requete-avec-formatage-en-iso-6801:e4f693dbd06f39f7a3b961939b760122">requete avec formatage en iso 6801</h2>

<p>Ok, maintenant le stockage est en place, comment maintenant servir ses données dans le bon format.</p>

<h2 id="quid-de-mysql-mongo-et-autre:e4f693dbd06f39f7a3b961939b760122">Quid de mySql, mongo et autre&hellip;.</h2>

<h1 id="node-api-et-requete:e4f693dbd06f39f7a3b961939b760122">Node, API et requete</h1>

<p>On ne va pas sortir les données directement depuis postgres, on va passer par un serveur API. Ici, ce sera du node.</p>

<h2 id="configuration-de-node-en-utc:e4f693dbd06f39f7a3b961939b760122">Configuration de node en UTC</h2>

<p>Pourquoi c&rsquo;est imortant ? exemple en direct de console sur les dates.
Donc si on utilise Node pour reformater les dates (ce qui ne sera pas forcement le cas puisqu&rsquo;on sort les dates correctement formatées depuis postgres).
Configuration et/ou option au lancement</p>

<h1 id="consommateur-de-l-api:e4f693dbd06f39f7a3b961939b760122">Consommateur de l&rsquo;API</h1>

<p>Nous avont donc maintenant une API exposant des dates en UTC, et c&rsquo;est chouette. Maintenant, comment les consommer sans se tromper.</p>

<h2 id="javascript-et-fonction-new-date:e4f693dbd06f39f7a3b961939b760122">Javascript et fonction new Date</h2>

<p>Note sur le problème safari
Formatage en retour (POST API)
Timezone du navigateur</p>

<h2 id="cas-du-php:e4f693dbd06f39f7a3b961939b760122">Cas du Php</h2>

<p>Timezone du serveur.</p>

<h2 id="cas-du-go:e4f693dbd06f39f7a3b961939b760122">Cas du Go</h2>

<p>A voir</p>

<h1 id="conclusion:e4f693dbd06f39f7a3b961939b760122">Conclusion</h1>

<p>Ce n&rsquo;est pas très compliqué, et certainement pas très nouveau. On connait les problème de dates et de reference (Bug de l&rsquo;an 2000).
Il faut juste être rigoureux, prévoir dès le début pour être sûre de ne pas perdre d&rsquo;information.
Mais c&rsquo;est souvent fondamentale.</p>

<hr />

<script type='text/javascript'>
console.log(Date.parse('2015-04-01 00:00:00'));
console.log(new Date('2015/04/01 00:00:00'));
console.log(new Date('2015/04/01 00:00:00+00'));
</script>

<p>ALTER TABLE value ADD COLUMN date_UTC timestamp with time zone;
UPDATE value SET date_UTC = date;
ALTER TABLE value ADD COLUMN date_converted timestamp without time zone;
UPDATE value SET date_converted = date;
ALTER TABLE value ALTER COLUMN date_converted TYPE timestamp with time zone;</p>

<p>date         |        date_utc        |     date_converted
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
2015-07-17 20:00:29 | 2015-07-17 20:00:29+00 | 2015-07-17 20:00:29+00
2015-07-17 20:00:29 | 2015-07-17 20:00:29+00 | 2015-07-17 20:00:29+00
2015-07-17 20:00:29 | 2015-07-17 20:00:29+00 | 2015-07-17 20:00:29+00
2015-07-17 20:00:29 | 2015-07-17 20:00:29+00 | 2015-07-17 20:00:29+00
2015-07-17 20:00:29 | 2015-07-17 20:00:29+00 | 2015-07-17 20:00:29+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-08-20 20:31:01 | 2015-08-20 20:31:01+00 | 2015-08-20 20:31:01+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-21 20:28:00 | 2015-05-21 20:28:00+00 | 2015-05-21 20:28:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-05-29 20:50:00 | 2015-05-29 20:50:00+00 | 2015-05-29 20:50:00+00
2015-07-01 21:30:00 | 2015-07-01 21:30:00+00 | 2015-07-01 21:30:00+00
2015-07-01 21:30:00 | 2015-07-01 21:30:00+00 | 2015-07-01 21:30:00+00
2015-07-01 21:30:00 | 2015-07-01 21:30:00+00 | 2015-07-01 21:30:00+00</p>

<p>ALTER TABLE value ALTER COLUMN date TYPE timestamp with time zone;
UPDATE value SET date=&lsquo;2015-07-09 12:17:37+00&rsquo;  WHERE date=&lsquo;2015-07-09 12:17:37.889+00&rsquo;;
UPDATE value SET date=&lsquo;2015-08-26 08:19:50+00&rsquo; WHERE date=&lsquo;2015-08-26 08:19:50.203+00&rsquo;;</p>

<p>to_char(created at time zone &lsquo;UTC&rsquo;, &lsquo;YYYY-MM-DD&rdquo;T&rdquo;HH24:MI:SS&rdquo;Z&rdquo;&lsquo;) as stamp</p>

<p>///////////////////////////////////////////</p>

<p>create table testDate(tsans timestamp without time zone, tavec timestamp with time zone);
TRUNCATE testDate;
insert into testDate(tsans, tavec) values (&lsquo;2015-09-18 16:20:00&rsquo;, &lsquo;2015-09-18 16:20:00&rsquo;);
insert into testDate(tsans, tavec) values (&lsquo;2015-09-18 16:20:00+02&rsquo;, &lsquo;2015-09-18 16:20:00+02&rsquo;);
insert into testDate(tsans, tavec) values (&lsquo;2015-09-18 15:20:00+01&rsquo;, &lsquo;2015-09-18 15:20:00+01&rsquo;);
insert into testDate(tsans, tavec) values (&lsquo;2015-09-18T16:20:00Z&rsquo;, &lsquo;2015-09-18T16:20:00Z&rsquo;);
insert into testDate(tsans, tavec) values (&lsquo;2015-09-18T16:20:00+02:00&rsquo;, &lsquo;2015-09-18T16:20:00+02:00&rsquo;);</p>

<p>SELECT
tsans, to_char(tsans at time zone &lsquo;UTC&rsquo;, &lsquo;YYYY-MM-DD&rdquo;T&rdquo;HH24:MI:SS&rdquo;Z&rdquo;&lsquo;) as tsans_ISO6801,
tavec, to_char(tavec at time zone &lsquo;UTC&rsquo;, &lsquo;YYYY-MM-DD&rdquo;T&rdquo;HH24:MI:SS&rdquo;Z&rdquo;&lsquo;) as tavec_ISO6801 FROM testDate;</p>

<pre><code>    tsans        |    tsans_iso6801     |         tavec          |    tavec_iso6801
</code></pre>

<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
 2015-09-18 16:20:00 | 2015-09-18T16:20:00Z | 2015-09-18 16:20:00+00 | 2015-09-18T16:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T16:20:00Z | 2015-09-18 14:20:00+00 | 2015-09-18T14:20:00Z
 2015-09-18 15:20:00 | 2015-09-18T15:20:00Z | 2015-09-18 14:20:00+00 | 2015-09-18T14:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T16:20:00Z | 2015-09-18 16:20:00+00 | 2015-09-18T16:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T16:20:00Z | 2015-09-18 14:20:00+00 | 2015-09-18T14:20:00Z</p>

<p>SI je change la time zone de ma base (de UTC à Europe/Paris)</p>

<pre><code>    tsans        |    tsans_iso6801     |         tavec          |    tavec_iso6801
</code></pre>

<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-
 2015-09-18 16:20:00 | 2015-09-18T18:20:00Z | 2015-09-18 16:20:00+02 | 2015-09-18T14:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T18:20:00Z | 2015-09-18 16:20:00+02 | 2015-09-18T14:20:00Z
 2015-09-18 15:20:00 | 2015-09-18T17:20:00Z | 2015-09-18 16:20:00+02 | 2015-09-18T14:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T18:20:00Z | 2015-09-18 18:20:00+02 | 2015-09-18T16:20:00Z
 2015-09-18 16:20:00 | 2015-09-18T18:20:00Z | 2015-09-18 16:20:00+02 | 2015-09-18T14:20:00Z</p>

                    </div>
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'xxxx';
    var disqus_identifier = 'http:\/\/localhost:1313\/notes\/bootstrapingTime\/';
    var disqus_title = 'Bootstraping your dates';
    var disqus_url = 'http:\/\/localhost:1313\/notes\/bootstrapingTime\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="http://localhost:1313//js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-xxxxxx-xx', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
